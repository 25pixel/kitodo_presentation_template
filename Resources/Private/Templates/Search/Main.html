<f:comment>
<!--
 * (c) Kitodo. Key to digital objects e.V. <contact@kitodo.org>
 *
 * This file is part of the Kitodo and TYPO3 projects.
 *
 * @license GNU General Public License version 3 or later.
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
-->
</f:comment>
<html xmlns:content="http://purl.org/rss/1.0/modules/content/"
      xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:form action="search" controller="Search" name="searchParameter" method="get">
    <label for="tx-dlf-search-query">
        <f:if condition="{lastSearch.query}">
            <f:then>{lastSearch.query -> f:format.htmlspecialchars()}</f:then>
            <f:else><f:translate key="search.query"/></f:else>
        </f:if>
    </label>

    <f:form.textfield id="tx-dlf-search-query" property="query" value="{lastSearch.query}" />

    <f:if condition="{showLogicalPageField}">
        <f:then>
            <!-- Logical page -->
            <label for="tx-dlf-search-logical-page"><f:translate key="search.logicalPage"/>: </label>
            <f:form.textfield class="tx-dlf-search-logical-page" id="tx-dlf-search-logical-page" name="logicalPage" />
        </f:then>
    </f:if>

    <f:comment><!-- The following element is needed for auto-completion! --></f:comment>
    <div id="tx-dlf-search-suggest"></div>

    <f:form.submit value="{f:translate(key: 'search.submit')}" />

    <!-- Fulltext switch -->
    <f:form.radio property="fulltext" value="0" id="tx-dlf-search-fulltext-no" class="tx-dlf-search-fulltext" checked="{lastSearch.fulltext} == 0" />
    <label for="tx-dlf-search-fulltext-no"><f:translate key="search.inMetadata"/></label>
    <f:form.radio property="fulltext" value="1" id="tx-dlf-search-fulltext-yes" class="tx-dlf-search-fulltext-yes" checked="{lastSearch.fulltext} == 1" />
    <label for="tx-dlf-search-fulltext-yes"><f:translate key="search.inFulltext"/></label>

    <f:if condition="{settings.collections}">
        <f:form.hidden property="collections" value="{settings.collections}" />
    </f:if>
    <f:if condition="{settings.collections}">
        <f:form.hidden property="documentId" value="{settings.collections}" />
    </f:if>

    <!-- Add current document -->
    <f:if condition="{DOCUMENT_ID}">
        <f:then>
            <f:form.hidden name="documentId" value="{DOCUMENT_ID}"/>
        </f:then>
    </f:if>

    <!-- Add collection -->
    <f:if condition="{COLLECTION_ID}">
        <f:then>
            <input type="hidden" name="collection" value="{COLLECTION_ID}" />
        </f:then>
    </f:if>

    <div class="tx-dlf-search-extended">
        <f:for each="{extendedSlotCount}" as="slot" key="slot_label" iteration="slot_iterator">
            <f:form.select name="extOperator.{slot_iterator.index}" options="{operators}" class="tx-dlf-search-operator tx-dlf-search-operator-{slot_iterator.index}"/>
            <f:form.select name="extField.{slot_iterator.index}" options="{searchFields}" class="tx-dlf-search-field-option tx-dlf-search-field-{slot_iterator.index}"/>
            <f:form.textfield name="extQuery.{slot_iterator.index}" class="tx-dlf-search-query tx-dlf-search-query-{slot_iterator.index}"/>
        </f:for>
    </div>

    <f:form.hidden property="orderBy" value="{lastSearch.orderBy}" />
    <f:form.hidden property="order" value="{lastSearch.order}" />

</f:form>

<f:if condition="{settings.targetPid} == '' && {documents}">

    <div class="tx-dlf-listview">
        <f:render partial="ListView/SortingForm" arguments="{_all}" />
        <f:render partial="ListView/Results" arguments="{_all}" />
    </div>

</f:if>

<div class="tx-dlf-search-facets">
    <f:for each="{facetsMenu}" as="facet">
        <ul>
            <li class="tx-dlf-search-no {f:if(condition: '{facet._SUB_MENU}', then: 'tx-dlf-search-ifsub')}">
                {facet.title}
            </li>
            <f:if condition="{facet._SUB_MENU}">
                <f:then>
                    <ul>
                        <f:for each="{facet._SUB_MENU}" as="values">
                            <li class="">
                                <f:link.typolink parameter="{values._OVERRIDE_HREF}">
                                    {values.title}
                                </f:link.typolink>
                            </li>
                        </f:for>
                    </ul>
                </f:then>
            </f:if>

        </ul>
    </f:for>
</div>

</html>

<f:section name="FooterAssets">
    <f:if condition="{settings.suggest}">
        <script src="{f:uri.resource(path: 'Javascript/Search/Suggester.js')}"></script>
    </f:if>
</f:section>
